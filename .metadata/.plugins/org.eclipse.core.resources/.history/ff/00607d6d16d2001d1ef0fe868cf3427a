/*
 * pid.c
 *
 *  Created on: Mar 22, 2023
 *      Author: Administrator
 */
#include "pid.h"
#include "main.h"
pid_controller pid;
//初始化
void pid_init(pid_controller* pid, float kp, float ki, float kd)
{
	pid->kp = kp;
	pid->ki = ki;
	pid->kd = kd;
	pid->setpoint = 0.0;
	pid->feedback = 0.0;
	pid->integral = 0.0;
	pid->prev_error = 0.0;
}
//计算
float pid_compute(pid_controller* pid, float feedback)
{
	float error = pid->setpoint - feedback;
	pid->integral += error;
	float derivative = error - pid->prev_error;
	float output = pid->kp * error + pid->ki * pid->integral + pid->kd * derivative;
	pid->prev_error = error;
	pid->feedback = feedback;
	return output;
}
//重置
void pid_reset(pid_controller* pid)
{
	pid->setpoint = 0.0;
	pid->feedback = 0.0;
	pid->integral = 0.0;
	pid->prev_error = 0.0;
}

void pid_change(float output)
{
	TIM2->CCR1=(uint32_t)output;
}
